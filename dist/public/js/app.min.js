angular.module("eventManager",["ngRoute","ngStorage","ngFileUpload","typer","toaster"]).config(["$routeProvider","$httpProvider","$locationProvider",function(e,t,n){n.html5Mode(!1),n.hashPrefix("!"),e.when("/home",{templateUrl:"pages/home.html",controller:"mainCtrl"}).when("/events",{templateUrl:"pages/events.html",controller:"eventCtrl"}).when("/event/:event",{templateUrl:"pages/eventbyid.html",controller:"eventCtrl"}).when("/contact",{templateUrl:"pages/contact_form.html",controller:"contactCtrl"}).when("/admin",{templateUrl:"pages/admin.html",controller:"adminCtrl"}).when("/adminEvent",{templateUrl:"pages/adminEvent.html",controller:"adminCtrl"}).when("/adminEvent/:name",{templateUrl:"pages/adminEventByid.html",controller:"eventAdminCtrl"}).when("/queryList",{templateUrl:"pages/queryList.html",controller:"queryCtrl"}).when("/query/:id",{templateUrl:"pages/queryById.html",controller:"queryCtrl"}).when("/login",{templateUrl:"pages/login.html",controller:"loginCtrl"}).otherwise({redirectTo:"/home"})}]).run(["$rootScope","$location","$http","$sessionStorage",function(e,t,n,o){e.$on("$routeChangeStart",function(e,n,r){null!==o.atoken&&void 0!==o.atoken||"pages/home.html"===n.templateUrl||"pages/login.html"===n.templateUrl||"pages/events.html"===n.templateUrl||"pages/eventbyid.html"===n.templateUrl||("pages/admin.html"===n.templateUrl?t.path("/login"):t.path("/home"))})}]).factory("httpRequestInterceptor",["$sessionStorage",function(e){return{request:function(t){return t.headers.token=e.atoken,t}}}]).factory("MyCache",["$cacheFactory",function(e){return e("myCache")}]).controller("mainCtrl",["$sessionStorage","$scope",function(e,t){t.start=!1,t.Trigger=function(){t.start=!0}}]).controller("eventCtrl",["$sessionStorage","$location","$scope","$http","$routeParams","MyCache",function(e,t,n,o,r,a){o.get("/eventlist",{cache:!0}).then(function(e){console.log(e.data),n.events=e.data}),console.log(r.event),n.getEvent=function(){o.get("/event/"+r.event).then(function(e){console.log(e.data),n.event=e.data})}}]).controller("queryCtrl",["$sessionStorage","$location","$scope","$http","$routeParams",function(e,t,n,o,r){n.getList=function(){o.get("/admin/querylist").then(function(e){console.log(e.data),n.query=e.data})},n.getQuery=function(){o.get("/admin/query/"+r.id).then(function(e){n.queryOne=e.data,console.log(e)})},n.getLoc=function(e){t.path("/query/"+e)}}]).controller("contactCtrl",["$sessionStorage","$location","$scope","$http","$window","toaster",function(e,t,n,o,r,a){n.submit=function(){var e={name:n.name,email:n.email,subject:n.subject,message:n.message,phone:n.phone};o({url:"/addQuery",method:"POST",data:e}).then(function(e){a.success({title:"Success",body:"We will contact you soon"}),a.pop("error","Email Sended","<ul><li>Render html</li></ul>",null,"trustedHtml",5e3,"trustedHtml",function(e){var t=e.body.match(/http[s]?:\/\/[^\s]+/);return t&&r.open(t[0]),!0})})}}]).controller("adminCtrl",["$sessionStorage","$location","$scope","$http","$route",function(e,t,n,o,r){void 0===e.atoken&&t.path("/login"),o.get("/eventlist").then(function(e){console.log(e.data),n.events=e.data}),n.getLoc=function(e){t.path("/adminEvent/"+e)},n.delete=function(e){var t={id:e};o.post("/admin/remove",t).then(function(e){r.reload()})}}]).controller("imageCtrl",["Upload","$window","$scope",function(e,t,n,o){var r=this;r.submit=function(e,t){"insert"===e?r.upload_form.file.$valid&&r.file&&r.upload(r.file):"update"===e&&r.edit(r.file,t)},r.upload=function(o){var a={file:o,event:n.eventName,description:n.eventDescription};e.upload({url:"/admin/upload",data:a}).then(function(e){0===e.data.error_code?t.alert("Success "+e.config.data.file.name+"uploaded. Response: "):t.alert("an error occured")},function(e){console.log("Error status: "+e.status),t.alert("Error status: "+e.status)},function(e){console.log(e);var t=parseInt(100*e.loaded/e.total);console.log("progress: "+t+"% "+e.config.data.file.name),r.progress="progress: "+t+"% "})},r.edit=function(o,a){var l={id:a,file:o,event:n.event.event,description:n.event.description};e.upload({url:"/admin/update",data:l}).then(function(e){0===e.data.error_code?t.alert("Success "+e.config.data.file.name+"uploaded. Response: "):t.alert("an error occured")},function(e){console.log("Error status: "+e.status),t.alert("Error status: "+e.status)},function(e){console.log(e);var t=parseInt(100*e.loaded/e.total);console.log("progress: "+t+"% "+e.config.data.file.name),r.progress="progress: "+t+"% "})}}]).controller("eventAdminCtrl",["$http","$routeParams",function(e,t){$scope.getEvent=function(){e.get("/event/"+t.name).then(function(e){$scope.event=e.data})}}]).controller("loginCtrl",["$sessionStorage","$location","$scope","$http","$routeParams","$route",function(e,t,n,o,r,a){n.check=function(){o.post("/admin/checkUsr").then(function(e){})},n.showErr=!1,n.login=function(){var r={username:n.user,password:n.pass};o({url:"/admin/login",method:"POST",data:r}).then(function(t){console.log(t),t.data.message?(n.showErr=!0,n.err=t.data.message):(e.atoken=t.data.token,e.id=t.data.user._id)}).then(function(e){!1===n.showErr&&t.path("/admin")})}}]);