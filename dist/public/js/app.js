angular.module("eventManager",["ngRoute","ngStorage","ngFileUpload","typer","ngAnimate","toaster"]).config(function(e,t,n){n.html5Mode(!1),n.hashPrefix("!"),e.when("/home",{templateUrl:"pages/home.html",controller:"mainCtrl"}).when("/events",{templateUrl:"pages/events.html",controller:"eventCtrl"}).when("/event/:event",{templateUrl:"pages/eventbyid.html",controller:"eventCtrl"}).when("/contact",{templateUrl:"pages/contact_form.html",controller:"contactCtrl"}).when("/admin",{templateUrl:"pages/admin.html",controller:"adminCtrl"}).when("/adminEvent",{templateUrl:"pages/adminEvent.html",controller:"adminCtrl"}).when("/adminEvent/:name",{templateUrl:"pages/adminEventByid.html",controller:"eventAdminCtrl"}).when("/queryList",{templateUrl:"pages/queryList.html",controller:"queryCtrl"}).when("/query/:id",{templateUrl:"pages/queryById.html",controller:"queryCtrl"}).when("/login",{templateUrl:"pages/login.html",controller:"loginCtrl"}).otherwise({redirectTo:"/home"})}).run(function(e,t,n,o){e.$on("$routeChangeStart",function(e,n,a){null!==o.atoken&&void 0!==o.atoken||"pages/home.html"===n.templateUrl||"pages/login.html"===n.templateUrl||"pages/events.html"===n.templateUrl||"pages/eventbyid.html"===n.templateUrl||("pages/admin.html"===n.templateUrl?t.path("/login"):t.path("/home"))})}).factory("httpRequestInterceptor",function(e){return{request:function(t){return t.headers.token=e.atoken,t}}}).factory("MyCache",function(e){return e("myCache")}).controller("mainCtrl",function(e,t){t.start=!1,t.Trigger=function(){t.start=!0}}).controller("eventCtrl",function(e,t,n,o,a,r){o.get("/eventlist",{cache:!0}).then(function(e){console.log(e.data),n.events=e.data}),console.log(a.event),n.getEvent=function(){o.get("/event/"+a.event).then(function(e){console.log(e.data),n.event=e.data})}}).controller("queryCtrl",function(e,t,n,o,a){n.getList=function(){o.get("/admin/querylist").then(function(e){console.log(e.data),n.query=e.data})},n.getQuery=function(){o.get("/admin/query/"+a.id).then(function(e){n.queryOne=e.data,console.log(e)})},n.getLoc=function(e){t.path("/query/"+e)}}).controller("contactCtrl",function(e,t,n,o,a,r){n.submit=function(){var e={name:n.name,email:n.email,subject:n.subject,message:n.message,phone:n.phone};o({url:"/addQuery",method:"POST",data:e}).then(function(e){r.success({title:"Success",body:"We will contact you soon"}),r.pop("error","Email Sended","<ul><li>Render html</li></ul>",null,"trustedHtml",5e3,"trustedHtml",function(e){var t=e.body.match(/http[s]?:\/\/[^\s]+/);return t&&a.open(t[0]),!0})})}}).controller("adminCtrl",function(e,t,n,o,a){void 0===e.atoken&&t.path("/login"),o.get("/eventlist").then(function(e){console.log(e.data),n.events=e.data}),n.getLoc=function(e){t.path("/adminEvent/"+e)},n.delete=function(e){var t={id:e};o.post("/admin/remove",t).then(function(e){a.reload()})}}).controller("imageCtrl",["Upload","$window","$scope",function(e,t,n,o){var a=this;a.submit=function(e,t){"insert"===e?a.upload_form.file.$valid&&a.file&&a.upload(a.file):"update"===e&&a.edit(a.file,t)},a.upload=function(o){var r={file:o,event:n.eventName,description:n.eventDescription};e.upload({url:"/admin/upload",data:r}).then(function(e){0===e.data.error_code?t.alert("Success "+e.config.data.file.name+"uploaded. Response: "):t.alert("an error occured")},function(e){console.log("Error status: "+e.status),t.alert("Error status: "+e.status)},function(e){console.log(e);var t=parseInt(100*e.loaded/e.total);console.log("progress: "+t+"% "+e.config.data.file.name),a.progress="progress: "+t+"% "})},a.edit=function(o,r){var l={id:r,file:o,event:n.event.event,description:n.event.description};e.upload({url:"/admin/update",data:l}).then(function(e){0===e.data.error_code?t.alert("Success "+e.config.data.file.name+"uploaded. Response: "):t.alert("an error occured")},function(e){console.log("Error status: "+e.status),t.alert("Error status: "+e.status)},function(e){console.log(e);var t=parseInt(100*e.loaded/e.total);console.log("progress: "+t+"% "+e.config.data.file.name),a.progress="progress: "+t+"% "})}}]).controller("eventAdminCtrl",function(e,t,n,o,a,r){n.getEvent=function(){o.get("/event/"+a.name).then(function(e){n.event=e.data})}}).controller("loginCtrl",function(e,t,n,o,a,r){n.check=function(){o.post("/admin/checkUsr").then(function(e){})},n.showErr=!1,n.login=function(){var a={username:n.user,password:n.pass};o({url:"/admin/login",method:"POST",data:a}).then(function(t){console.log(t),t.data.message?(n.showErr=!0,n.err=t.data.message):(e.atoken=t.data.token,e.id=t.data.user._id)}).then(function(e){!1===n.showErr&&t.path("/admin")})}});